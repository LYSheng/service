@{
    ViewBag.Title = "猫市会员特惠店";
    Layout = "../Shared/_LayoutFooter.cshtml";
}
@section Head
{
    @*@WebHelper4H5.RegisterStyles("newStyles/mzui/amazeui.css")*@
    @WebHelper4H5.RegisterStyles("newStyles/style.css")
    @WebHelper4H5.RegisterStyles("newStyles/main.css")
    @WebHelper4H5.RegisterStyles("newStyles/dyl.css")
    <style>
        .poiEventsNone {
            pointer-events: none;
            background: #ccc !important;
        }

        #get_captcha, #apply_join {
            cursor: pointer;
        }

    </style>
}

<div id="HeadImg">
    <img src="/Content/images/newImages/vip.jpg">
</div>
<div class="Vipform pad4">
    <div>
        <p>手机号码</p>
        <p><input id="phone" type="text" placeholder="请输入常用手机号码"></p>
    </div>
    <div>
        <p>验证码</p>
        <p><input id="captcha_code" type="text" placeholder=""></p>
        <p><span id="get_captcha">发送验证码</span></p>
    </div>
</div>
<div class="submit_btn pad4" id="apply_join">
    <span>完成激活</span>
</div>
<div class="kind_remind pad4">
    <p>会员福利</p>
    <p>1.交1万元的会员费，可以消费1万元。</p>
    <p>2.每个月可以拿店铺10%的营业额分红，投入多少就分红多少,分红完投入资金为止。</p>
    <p>3.推荐会员，可以提成15%。</p>
</div>
<input id="ReferrerUserId" type="hidden" value="@ViewBag.ReferrerUserId" />
<script>
    $(function () {
        $("#get_captcha").click(function () {
            var phone = $("#phone").val();
            if (phone == "" || phone == null) {
                smGlobal.error("请输入手机号");
                return false;
            }
            else {
                if (phone.length != 11) {
                    smGlobal.error("手机号码长度不合法！");
                    return false;
                }
            }
            var params = { Phone: phone }
            //console.log(params);
            //return;
            apiRequest({
                method: "User/SendBindCode",
                async: false,
                data: params,
                success: function (obj) {
                    if (obj.data.isSend) {
                        //captcha = obj.data.captcha;
                        doInterval();
                    }
                },
                error: function (obj) {
                    smGlobal.heiAutoError(obj, 2500);
                }
            });
        });

        var doInterval = function () {
            if (num > 0) {
                num = num - 1;
                //self.showTime("重新发送(" + num + ")秒");
                $("#get_captcha").text(num + "秒重新发送").addClass("poiEventsNone");
                setTimeout(function () { doInterval() }, 1000);
            }
            else {
                $("#get_captcha").text("获取验证码").removeClass("poiEventsNone");
                num = 60;
            }
        };


        $("#apply_join").click(function () {

            var phone = $("#phone").val();
            var captchaCode = $("#captcha_code").val();
            var referrerUserId = $("#ReferrerUserId").val();

            if (phone == "" || phone == null) {
                smGlobal.error("请输入手机号");
                return false;
            } else {
                if (phone.length != 11) {
                    smGlobal.error("手机号码长度不合法！");
                    return false;
                }
            }
            
            if (captchaCode == "" || captchaCode == null) {
                smGlobal.error("请输入验证码！");
                return false;
            }


            //绑定会员
            $.post('/UserAbout/SubmitBindMember', { phone: phone, captchaCode: captchaCode, referrerUserId: referrerUserId }, function (result) {
                if (result.IsBizSuccess) {
                    window.location.href = "/userAbout/applyjoin";
                }
            });
        });
    });
</script>
