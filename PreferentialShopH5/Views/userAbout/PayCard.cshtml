@{
    ViewBag.Title = "充值成为会员";
    Layout = "../Shared/_LayoutNone.cshtml";
}

@section Head
{
    @*@WebHelper4H5.RegisterStyles("newStyles/mzui/amazeui.css")*@
    @WebHelper4H5.RegisterStyles("newStyles/style.css?v=1.0")
    @WebHelper4H5.RegisterStyles("newStyles/main.css")
    @WebHelper4H5.RegisterStyles("newStyles/dyl.css")
    @WebHelper4H5.RegisterStyles("newStyles/wxq.css")
    @WebHelper4H5.RegisterStyles("newStyles/lsm.css")
    <style>
        #head_tit .head_tit_left, #head_tit .head_tit_right {
            width: 75px;
        }

        .tip {
            font-size: 16px;
            color: #b4282d;
            padding: 10px;
            background-color: #fff;
        }

        .waitpay {
            display: -webkit-flex;
        }

            .waitpay > div {
                -webkit-flex: 1;
                height: 45px;
                line-height: 45px;
                background-color: #b4282d;
                margin: 10px;
                text-align: center;
                color: #fff;
            }

                .waitpay > div:nth-child(1) {
                    background-color: #999;
                }

        .select, #cancle, #go_pay {
            cursor: pointer;
        }
        /*充值协议*/
        .chargeRule {
            -webkit-box-align: center;
            align-items: center;
            background: #fff;
            padding: 10px 4% 0 4%;
            font-size: 14px;
        }

            .chargeRule span {
                display: block;
                width: 14px;
                height: 14px;
                background: url("../content/images/changeRule.png") 0 0 no-repeat;
                background-size: 14px 40px;
                margin-right: 10px;
            }

                .chargeRule span.open {
                    background-position: 0 100%;
                }

            .chargeRule p {
                color: #666;
            }

            .chargeRule a {
                display: block;
                color: #ff0000;
            }

        .ruleDetail {
            width: 100%;
            height: 100%;
            position: fixed;
            top: 0;
            left: 0;
            display: -webkit-box;
            -webkit-box-align: center;
            -webkit-box-pack: center;
            background: rgba(0,0,0,0.6);
            z-index: 99999;
            opacity: 0;
            -webkit-transition: all 0.3s ease-out;
            pointer-events: none;
        }

            .ruleDetail.open {
                opacity: 1;
                pointer-events: auto;
            }

            .ruleDetail .contents {
                width: 80%;
                height: 80%;
                background: #fff;
                overflow: auto;
                -webkit-overflow-scrolling: touch;
                -webkit-transform: scale(0,0);
                -webkit-transition: all 0.3s ease-out;
            }

            .ruleDetail.open .contents {
                -webkit-transform: scale(1,1);
            }

            .ruleDetail .contents .rule-content {
                padding: 20px 10px;
            }

            .ruleDetail .rule-close {
                width: 24px;
                height: 24px;
                position: absolute;
                display: block;
                background: url("../content/images/rule_close.png");
                background-size: cover;
                top: 10%;
                right: 10%;
                z-index: 999;
                margin: -12px;
                opacity: 0;
                -webkit-transition: all 0s ease-out 0.3s;
            }

            .ruleDetail.open .rule-close {
                opacity: 1;
            }

            .ruleDetail .contents h1 {
                text-align: center;
                line-height: 50px;
                color: #b4282d;
                font-size: 18px;
                border-bottom: 1px solid #b4282d;
            }

            .ruleDetail .contents h2 {
                color: #333;
                font-size: 14px;
                line-height: 24px;
                padding: 3px 0;
            }

            .ruleDetail .contents h3 {
                color: #333;
                text-align: center;
                font-size: 14px;
                line-height: 24px;
                padding: 3px 0;
            }

            .ruleDetail .contents span {
                display: block;
                line-height: 20px;
            }

            .ruleDetail .contents p {
                text-indent: 2em;
                color: #504d4e;
                font-size: 12px;
                line-height: 20px;
                padding: 2px 0;
            }

        .onError {
            min-width: 12rem;
            margin-left: -6rem;
            margin-top: -1.8rem;
            padding: 0 2rem;
            max-width: 20rem;
            border-radius: .2rem;
            height: 3.6rem;
            line-height: 3.6rem;
            font-size: 1rem;
        }
        .warring{
            position:fixed;
            width:100%;
            left:0;
            bottom:0;
            background:#fff;
            color:#444;
            border-top:1px solid #dedede;
            padding:10px 20px; 
        }
        .topWarring {
            line-height: 20px;
            font-size: 13px;
            color: #b4282d;
            padding: 0.5rem 1rem;
        }
        #vipCardList {
            padding-bottom: 60px;
        }
    </style>
}

<header id="head_tit">
    <div class="head_tit_left back" backurl="/userAbout">
        <span class="icon-left c99"></span>
    </div>
    <div class="head_tit_center">
        充值成为会员
    </div>
    <div class="head_tit_right">
        @if (ViewBag.HasWaitPayInvestment == false)
{
    <p>下一步</p>
}
    </div>
</header>
<div class="HT_45 hideHeaderIOS"></div>

@if (ViewBag.HasWaitPayInvestment == false)
{
    <p class="d_recharge_remind pad4">选择会员卡种类 <span>(购买会员卡后，不支持退款)</span></p>
    @*<p class="topWarring">您现在充值成为本店前1000名会员<br/>将享有会员经营回馈</p>*@

    <div id="vipCardList" class="pad4">
        <ul>

            @for (int i = 0; i < ViewBag.InfoList.Length; i++)
            {

                <li class="vipCardItem">
                    <div class="card_left"><span class="select icon icon-nochose" value='@ViewBag.InfoList[i]["investmentAmountSetId"]'></span></div>
                    <div class="card_right">
                        <div class="card_right_wrap">
                            <div class="card_right_cont">
                                <div class="card_price">
                                    @ViewBag.InfoList[i]["investmentAmount"]<span>元</span>
                                </div>
                                <div class="card_welfare">

                                    <p>1.您将成为<span>@ViewBag.InfoList[i]["liveName"]</span></p>
                                    <p>
                                        2.获得<span>@ViewBag.InfoList[i]["canDividends"]</span>元会员经营回馈
                                    </p>

                                </div>
                            </div>
                        </div>
                    </div>
                </li>

            }
        </ul>
        
    </div>
    <div class="warring">
        <p>备注：</p>
        <p>1.会员经营回馈可提现或可继续消费</p>
        <p>2.推荐好友成为充值会员，即可共同获得等值好礼</p>
    </div>

    if (ViewBag.InfoList != null && ViewBag.InfoList.Length > 0)
    {
        <input type="hidden" id="cardId" value="@ViewBag.InfoList[0]["investmentAmountSetId"]" />
    }
    else
    {
        <input type="hidden" id="cardId" value="-1" />
    }
}
else
{
    <div>
        <div class="tip">您有一笔充值未支付，无法继续充值！</div>
        <div class="waitpay">
            <div id="cancle">取消充值</div>
            <div id="go_pay">去支付</div>
        </div>
    </div>
    <input type="hidden" id="InvestmentAmountSetId" value="@ViewBag.InvestmentAmountSetId" />
    <input type="hidden" id="ProviderID" value="@ViewBag.ProviderID" />
    <input type="hidden" id="InvestMentInfoId" value="@ViewBag.InvestMentInfoId" />
    
}
<input type="hidden" id="storeUserId" value="@Request["storeUserId"]" />

<script>
    $(".select").eq(0).addClass('icon-chose').addClass('active').removeClass("icon-nochose");
    $(function () {
        var _rule = false;
        
        $(".select").click(function () {
            $(".select").removeClass('icon-chose').removeClass('active').addClass('icon-nochose');
            $(this).addClass('icon-chose').addClass('active').removeClass("icon-nochose");
            $("#cardId").val($(this).attr("value"));
        });
        var isSubmit = false;
        $(".head_tit_right").click(function () {
            if (isSubmit) {
                return;
            }
            isSubmit = true;
            var cardId;
            var _this= $("#vipCardList ul li");
            var _length = _this.length;
            console.log(_length);
            
            for (var i = 0; i < _length; i++) {
                var _li = _this.eq(i);
                if (_li.find(".card_left .select").hasClass("active")) {
                    cardId = _li.find(".card_left .select").attr("value");
                    if (cardId > 0) {
                        apiRequest({
                            method: "User/IsBinDingPhone",
                            async: true,
                            success: function (obj) {
                                if (obj.isBizSuccess) {
                                    if (obj.data) {
                                        smGlobal.error("您还没有绑定手机号！", 1000);
                                        setTimeout(function () {
                                            isSubmit = false;
                                            window.location.href = "/account/register?isUpdateBind=true&cardId=" + cardId + "&shopId=" + $("#storeUserId").val();
                                            
                                        },1000)
                                    } else {
                                        isSubmit = false;
                                        window.location.href = "/userAbout/checkstand?cardId=" + cardId + "&shopId=" + $("#storeUserId").val();
                                        
                                    }
                                }
                                
                            },
                            error: function (obj) {
                                smGlobal.error(obj);
                                isSubmit = false;
                            }
                        });
                    } else {
                        smGlobal.error("请选择会员卡！");
                        isSubmit = false;
                    }
                    return;
                }
            }
            
            
        });

        $("#cancle").click(function () {
            if (hasClicked(this)) {
                return false;
            }
            $.post('/UserAbout/EndInvestment', { investmentId: $("#InvestMentInfoId").val() }, function (list) {
                if (list.IsBizSuccess) {
                    smGlobal.error("取消成功");
                    window.location.replace("/userAbout/PayCard?storeUserId=" + $("#storeUserId").val());
                    $("#cancle").removeClass("clickFlag");
                }
            });
        });

        $("#go_pay").click(function () {
            var cardId = $("#InvestmentAmountSetId").val();
            var shopId = $("#ProviderID").val();
            var investmentid = $("#InvestMentInfoId").val();
            window.location.href = "/userAbout/checkstand?investmentid=" + investmentid + "&cardId=" + cardId + "&shopId=" + shopId;
        });

        $("#chargeRuleDetail").on("click", function () {
            var _ruleDetail = $("#ruleDetail");
            if (!_ruleDetail.hasClass("open")) {
                _ruleDetail.addClass("open");
            }
        })

        $("#ruleClose").on("click", function () {
            var _ruleDetail = $("#ruleDetail");
            if (_ruleDetail.hasClass("open")) {
                _ruleDetail.removeClass("open");
            }
        })

        $("#choiceRule").on("click", function () {
            var _this = $(this);
            if (_this.hasClass("open")) {
                _this.removeClass("open");
                _rule = false;
            } else {
                _this.addClass("open");
                _rule = true;
            }
        })
    });

</script>